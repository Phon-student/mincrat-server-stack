services:
  mc:
    image: itzg/minecraft-server:java8
    container_name: modpack-mc
    tty: true
    stdin_open: true
    expose:
      - "25565"  # Expose internally only to other containers
    environment:
      EULA: "TRUE"
      TYPE: "AUTO_CURSEFORGE"
      VERSION: "1.16.5"
      CF_PAGE_URL: "https://www.curseforge.com/minecraft/modpacks/roguelike-adventures-and-dungeons-2"
      CF_API_KEY: "$$2a$$10$$bA6.2mGmk606PaYspFY6juhUcvFwc78AyRCEpcGuV4wgPcpJWkEPO"
      MEMORY: "8192M"
      MAX_PLAYERS: "10"
    volumes:
      - ./data:/data

  infrared:
    image: haveachin/infrared
    container_name: infrared
    restart: unless-stopped
    ports:
      - "25565:25565"  # Expose to the host
    environment:
      INFRARED_BACKEND: "modpack-mc:25565"  # Proxy backend to the Minecraft container
      INFRARED_BIND: "0.0.0.0:25565"  # Bind address for the proxy
      INFRARED_FRONTEND: "ngrok:25565"  # Frontend layer for ngrok
    volumes:
      - ./infrared/config:/config  # Mount configuration directory
      - ./infrared/logs:/logs      # Mount logs directory

  ngrok:
    image: wernight/ngrok
    container_name: ngrok
    restart: unless-stopped
    environment:
      NGROK_AUTHTOKEN: "2viEnLGSBQteIgQxlb8TRfPfolw_5Qi5FDXfcc5KCGqjruRG8"  # Replace with your ngrok auth token
      NGROK_REGION: "us"  # Specify the ngrok region (e.g., us, eu, ap)
      NGROK_PORT: "infrared:25565"  # Forward traffic to the infrared container
    ports:
      - "4040:4040"  # Expose ngrok web interface for monitoring

